// Veri seti
const data = [
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.860,69",
                         "forTl": 22328.28
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.101,48",
                         "forTl": 43420.72
                    },
                    {
                         "amount": 3480.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 3480.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.767,85",
                         "forTl": 45964.1
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.183,59",
                         "forTl": 6183.59
                    }
               ]
          ],
          "insertDate": "8 Ara 2023 Cum 22:25:57",
          "sunFunds": "121.376,84"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.880,09",
                         "forTl": 22561.079999999998
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.108,47",
                         "forTl": 43518.579999999994
                    },
                    {
                         "amount": 3480.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 3480.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.771,83",
                         "forTl": 46067.58
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.197,51",
                         "forTl": 6197.51
                    }
               ]
          ],
          "insertDate": "8 Ara 2023 Cum 17:27:24",
          "sunFunds": "121.824,90"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.889,17",
                         "forTl": 22670.04
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 3480.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 3480.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "8 Ara 2023 Cum 09:49:50",
          "sunFunds": "122.245,75"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.885,43",
                         "forTl": 22625.16
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 3480.16,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 3480.16
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "8 Ara 2023 Cum 01:24:04",
          "sunFunds": "122.200,88"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.885,43",
                         "forTl": 22625.16
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 3480.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 3480.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "8 Ara 2023 Cum 01:17:43",
          "sunFunds": "122.200,87"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.885,43",
                         "forTl": 22625.16
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 2580.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 2580.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "8 Ara 2023 Cum 01:15:27",
          "sunFunds": "121.300,87"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.886,08",
                         "forTl": 22632.96
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 2580.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 2580.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "8 Ara 2023 Cum 01:10:23",
          "sunFunds": "121.308,67"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.882,40",
                         "forTl": 22588.800000000003
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 2580.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 2580.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "7 Ara 2023 Per 20:46:50",
          "sunFunds": "121.264,51"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.879,22",
                         "forTl": 22550.64
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 2580.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 2580.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "7 Ara 2023 Per 20:44:41",
          "sunFunds": "121.226,35"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.884,14",
                         "forTl": 22609.68
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 2580.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 2580.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "7 Ara 2023 Per 20:17:20",
          "sunFunds": "121.285,39"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.884,38",
                         "forTl": 22612.56
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 2580.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 2580.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "7 Ara 2023 Per 20:01:24",
          "sunFunds": "121.288,27"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.886,16",
                         "forTl": 22633.920000000002
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 2580.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 2580.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "7 Ara 2023 Per 19:49:44",
          "sunFunds": "121.309,63"
     },
     {
          "fundsList": [
               [
                    {
                         "amount": 12,
                         "currencyType": "gram-altin",
                         "endex": "1.886,59",
                         "forTl": 22639.079999999998
                    },
                    {
                         "amount": 14,
                         "currencyType": "ceyrek-altin",
                         "endex": "3.118,59",
                         "forTl": 43660.26
                    },
                    {
                         "amount": 2580.15,
                         "currencyType": "TL",
                         "endex": 1,
                         "forTl": 2580.15
                    },
                    {
                         "amount": 26,
                         "currencyType": "22-ayar-bilezik",
                         "endex": "1.777,60",
                         "forTl": 46217.6
                    },
                    {
                         "amount": 1,
                         "currencyType": "yarim-altin",
                         "endex": "6.217,70",
                         "forTl": 6217.7
                    }
               ]
          ],
          "insertDate": "7 Ara 2023 Per 18:57:29",
          "sunFunds": "121.314,79"
     }
]

let previousValue;
const tableBody = document.getElementById('tableBody');
data.sort((a, b) => convertDate(a.insertDate).getTime() - convertDate(b.insertDate).getTime());
let tableList = [];
data.forEach(item => {
     const row = document.createElement('tr');

     const dateCell = document.createElement('td');
     dateCell.textContent = item.insertDate;
     row.appendChild(dateCell);

     const fundsCell = document.createElement('td');
     fundsCell.textContent = item.sunFunds;
     row.appendChild(fundsCell);
     let jsFormattedNumber =parseFloat(item.sunFunds.replace(/\./g, '').replace(',', '.'));
     if (previousValue !== undefined) {

          // Türkçe formatlı sayıyı JavaScript formatına dönüştürme
          jsFormattedNumber = parseFloat(item.sunFunds.replace(/\./g, '').replace(',', '.'));
          const currentValue = parseFloat(jsFormattedNumber);
          const previousNumericValue = parseFloat(previousValue);

          if (currentValue > previousNumericValue) {
               row.classList.add('change-up');
          } else if (currentValue < previousNumericValue) {
               row.classList.add('change-down');
          }
     }

     previousValue = jsFormattedNumber;
     tableList.push(row);
     //tableBody.appendChild(row);
});
let reversedTableList = tableList.reverse();
for (let i = 0; i < reversedTableList.length; i++) {
     tableBody.appendChild(reversedTableList[i]);
}
// Grafik oluşturma
let dates = data.map(item => item.insertDate);
function kisaTarih(tarih) {
     let parts = tarih.split(' ');
     return parts[0] + " " + parts[1] + " " + parts[4];
}
document.getElementById('snapshotSpan').innerText = 'Snapshot Veri Sayısı: '+reversedTableList.length;
dates = dates.map(tarih => kisaTarih(tarih));

const sunFunds = data.map(item => parseFloat(item.sunFunds.replace(/\./g, '').replace(',', '.')));

const ctx = document.getElementById('myChart').getContext('2d');
const myChart = new Chart(ctx, {
     type: 'line',
     data: {
          labels: dates,
          datasets: [{
               label: 'Birikim Değişimi',
               data: sunFunds,
               backgroundColor: 'rgba(54, 162, 235, 0.2)',
               borderColor: 'rgba(54, 162, 235, 1)',
               borderWidth: 1
          }]
     },
     options: {
          animation: {
               duration: 2000, // Animasyon süresi (ms cinsinden)
               easing: 'easeInOutQuart' // Animasyon tipi
          },
          scales: {
               y: {
                    ticks: {
                         beginAtZero: false // Y ekseninin sıfırdan başlamaması
                    }
               }
          }
     }
});

function convertDate(str) {
     const months = {
          "Oca": 0,
          "Şub": 1,
          "Mar": 2,
          "Nis": 3,
          "May": 4,
          "Haz": 5,
          "Tem": 6,
          "Ağu": 7,
          "Eyl": 8,
          "Eki": 9,
          "Kas": 10,
          "Ara": 11
     };

     const parts = str.split(' ');
     const day = parseInt(parts[0], 10);
     const month = months[parts[1]];
     const year = parseInt(parts[2], 10);
     const timeParts = parts[4].split(':');
     const hour = parseInt(timeParts[0], 10);
     const minute = parseInt(timeParts[1], 10);
     const second = parseInt(timeParts[2], 10);

     return new Date(year, month, day, hour, minute, second);
}
